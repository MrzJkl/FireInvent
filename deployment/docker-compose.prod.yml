# =============================================================================
# FireInvent Production Docker Compose
# =============================================================================
# This file extends the base docker-compose.yml for production deployment.
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
# =============================================================================

services:
  keycloak:
    command: ["start"]
    environment:
      # Production mode requires HTTPS
      KC_PROXY_HEADERS: xforwarded
      KC_HTTP_ENABLED: "true"
      KC_HOSTNAME_STRICT: "false"
      # For production with a reverse proxy handling TLS
      KC_HOSTNAME_STRICT_HTTPS: "false"
      # Health check endpoint
      KC_HEALTH_ENABLED: "true"
      KC_METRICS_ENABLED: "true"
    healthcheck:
      test: ["CMD-SHELL", "timeout 5 bash -c 'cat < /dev/null > /dev/tcp/localhost/8080' && wget --quiet --spider http://localhost:8080/health/ready"]
      interval: 10s
      timeout: 10s
      retries: 10
      start_period: 60s
