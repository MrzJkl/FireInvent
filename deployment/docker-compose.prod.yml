# =============================================================================
# FireInvent Production Docker Compose
# =============================================================================
# This file extends the base docker-compose.yml for production deployment.
# Usage: docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
# =============================================================================

services:
  keycloak:
    command: ["start"]
    environment:
      # Production mode requires HTTPS
      KC_PROXY_HEADERS: xforwarded
      KC_HTTP_ENABLED: "true"
      KC_HOSTNAME_STRICT: "false"
      # For production with a reverse proxy handling TLS
      KC_HOSTNAME_STRICT_HTTPS: "false"
      # Health check endpoint
      KC_HEALTH_ENABLED: "true"
      KC_METRICS_ENABLED: "true"
    healthcheck:
      test: ["CMD-SHELL", "exec 3<>/dev/tcp/localhost/8080 && echo -e 'GET /health/ready HTTP/1.1\\r\\nHost: localhost\\r\\n\\r\\n' >&3 && cat <&3 | grep -q 'UP'"]
      interval: 10s
      timeout: 5s
      retries: 10
      start_period: 60s
